# 工事受注案件 予定表アプリ

本リポジトリは Streamlit 製の「工事受注案件の予定表」アプリです。案件の登録・編集、ガントチャート表示、集計分析、CSV 入出力が可能です。

## セットアップ

Python 3.10 以降を想定しています。

依存パッケージは `requirements.txt` にまとめています。

```bash
pip install -r requirements.txt
```

## 起動方法

```bash
streamlit run app.py
```

初回起動時に `data/projects.csv` が存在しない場合、自動的にサンプルデータが生成されます。

## 主な機能

- 事業年度ごとのタイムライン表示（7 月開始固定）
- 期間・ステータス・工種などによるフィルタリング
- 編集可能な案件一覧（`st.data_editor`）と CSV 永続化
- 月次売上・原価・粗利・延べ人数の集計とグラフ化
- 工種別・得意先別構成比、粗利率ヒストグラム
- バリューチェーン工程別の付加価値・コスト分析ダッシュボード
- シナリオ比較タブでの工期・進捗・コストの横断評価と CSV エクスポート
- スマートフォンからも更新しやすい進捗率スライダーとコスト入力 UI
- CSV インポート／エクスポート、テンプレートダウンロード
- マスタ（得意先・工種・担当者）および休日設定

## CSV 項目説明

| 列名 | 説明 |
| --- | --- |
| id | 案件を一意に識別する ID |
| 案件名 | 工事案件の名称 |
| 得意先 | 主要取引先（顧客名） |
| 元請区分 | 元請/一次/二次/三次 などの区分 |
| 工種 | 建築/土木/型枠/その他 等 |
| ステータス | 見積/受注/着工/施工中/完了/中止 |
| 着工日 | 着工予定日 |
| 竣工日 | 竣工予定日（着工日以降） |
| 受注金額 | 税抜受注金額（円） |
| 予定原価 | 見込原価（円） |
| 粗利率 | 粗利率（%） |
| 月平均必要人数 | 月平均の必要人数（人） |
| 担当部署 | 案件を管轄する部署 |
| バリューチェーン工程 | 原材料調達・施工準備・施工・検査・引き渡しの工程区分 |
| 現場所在地 | 都道府県 |
| 担当者 | 案件担当者 |
| 備考 | 現場メモや注意事項 |
| リスク度合い | リスクの主観評価（低/中/高） |

## フィルタの使い方

サイドバーから下記項目で絞り込みが可能です。

- 事業年度（7 月始まりの 1 年間）
- 期間（From / To）
- ステータス、工種、元請区分
- 主要取引先、担当者、現場所在地（都道府県）
- 粗利率レンジ（%）

選択したフィルタはタイムライン・案件一覧・集計タブに共通して適用されます。

## よくある質問

### Q. 年度を切り替えるには？
サイドバー上部の「事業年度」セレクトボックスから 2024〜2028 の年度を選択してください。年度は常に 7 月開始・翌年 6 月終了です。

### Q. 編集内容はどこに保存されますか？
`data/projects.csv` に保存されます。必要に応じてバックアップを取得してください。

### Q. CSV インポート時に既存データを残せますか？
アップロード後に「マージ」または「置換」を選択できます。マージは ID をキーに更新し、未登録 ID は追加します。置換は既存データを全て入れ替えます。

